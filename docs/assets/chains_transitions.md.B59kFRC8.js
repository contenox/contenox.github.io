import{_ as s,o as a,c as i,ag as e}from"./chunks/framework.DQQHyi2x.js";const k=JSON.parse('{"title":"Transitions & Branching","description":"","frontmatter":{},"headers":[],"relativePath":"chains/transitions.md","filePath":"chains/transitions.md"}'),o={name:"chains/transitions.md"};function n(h,t,r,l,d,p){return a(),i("div",null,[...t[0]||(t[0]=[e(`<h1 id="transitions-branching" tabindex="-1">Transitions &amp; Branching <a class="header-anchor" href="#transitions-branching" aria-label="Permalink to &quot;Transitions &amp; Branching&quot;">​</a></h1><p>Task chains are state machines. When a task finishes running its <code>handler</code>, the chain evaluates its <code>transition</code> rules to determine which task to execute next.</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;transition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;branches&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;operator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;equals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;when&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tool-call&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;goto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;run_tools&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;operator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;when&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;goto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;end&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="how-transitions-work" tabindex="-1">How transitions work <a class="header-anchor" href="#how-transitions-work" aria-label="Permalink to &quot;How transitions work&quot;">​</a></h2><ol><li>The current task returns a result string (the &quot;eval&quot;).</li><li>The engine checks the <code>transition.branches</code> array from top to bottom.</li><li>It evaluates the <code>when</code> condition against the eval string using the <code>operator</code>.</li><li>The first branch that evaluates to <code>true</code> determines the next step (<code>goto</code>).</li></ol><p>If the branch specifies <code>&quot;goto&quot;: &quot;end&quot;</code>, the chain terminates successfully.</p><h2 id="operators" tabindex="-1">Operators <a class="header-anchor" href="#operators" aria-label="Permalink to &quot;Operators&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Operator</th><th>How it matches</th><th>Example</th></tr></thead><tbody><tr><td><code>equals</code></td><td>Exact string match</td><td><code>&quot;when&quot;: &quot;tool-call&quot;</code> matches <code>&quot;tool-call&quot;</code></td></tr><tr><td><code>not_equals</code></td><td>Inverse exact match</td><td><code>&quot;when&quot;: &quot;error&quot;</code> matches <code>&quot;ok&quot;</code></td></tr><tr><td><code>contains</code></td><td>Substring match</td><td><code>&quot;when&quot;: &quot;fail&quot;</code> matches <code>&quot;api_failure&quot;</code></td></tr><tr><td><code>not_contains</code></td><td>Inverse substring match</td><td><code>&quot;when&quot;: &quot;ok&quot;</code> matches <code>&quot;error&quot;</code></td></tr><tr><td><code>range</code></td><td>Numeric range (min,max)</td><td><code>&quot;when&quot;: &quot;200,299&quot;</code> matches <code>&quot;201&quot;</code></td></tr><tr><td><code>default</code></td><td>Always matches</td><td>Used as the fallback at the end of the array</td></tr></tbody></table><h2 id="what-do-tasks-return" tabindex="-1">What do tasks return? <a class="header-anchor" href="#what-do-tasks-return" aria-label="Permalink to &quot;What do tasks return?&quot;">​</a></h2><p>Each handler returns a different eval string that you can branch on:</p><ul><li><strong><code>chat_completion</code></strong>: Returns <code>&quot;stop&quot;</code>, <code>&quot;tool-call&quot;</code>, or <code>&quot;length&quot;</code>.</li><li><strong><code>execute_tool_calls</code></strong>: Returns <code>&quot;ok&quot;</code> or <code>&quot;error&quot;</code>.</li><li><strong><code>condition_key</code></strong>: Returns the exact keyword the model chose (e.g. <code>&quot;valid&quot;</code> or <code>&quot;invalid&quot;</code>).</li><li><strong><code>hook</code></strong>: Usually returns <code>&quot;ok&quot;</code> or <code>&quot;failed&quot;</code>.</li></ul><h2 id="branch-composition" tabindex="-1">Branch Composition <a class="header-anchor" href="#branch-composition" aria-label="Permalink to &quot;Branch Composition&quot;">​</a></h2><p>You can extract data from a task&#39;s output and store it as a new variable during the transition. Use the <code>compose</code> object on a branch:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;operator&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;default&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;when&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;goto&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;next_step&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compose&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;with_var&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;extracted_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;strategy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json_path:$.user.id&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>If this branch is taken, the engine runs the JSONPath <code>$.user.id</code> against the task&#39;s output, and stores the result in a chain variable named <code>extracted_id</code>. Later tasks can use <span><code>{{.extracted_id}}</code></span> in their templates.</p>`,15)])])}const u=s(o,[["render",n]]);export{k as __pageData,u as default};
